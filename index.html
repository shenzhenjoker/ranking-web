
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>YCS World Cup - CPU Competition Leaderboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
  <style>
    body {
      background: url('background_cyberpunk.jpg') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 0;
      font-family: 'Orbitron', sans-serif;
      color: #0ff;
    }
    h1 {
      text-align: center;
      font-size: 40px;
      color: #f44;
      margin-top: 30px;
    }
    h2 {
      text-align: center;
      font-size: 20px;
      color: #0ff;
      margin-top: 10px;
    }
    .table-container {
      width: 95%;
      margin: 40px auto 100px;
      max-height: 60vh;
      overflow-y: auto;
      border: 2px solid #0ff;
      border-radius: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: rgba(0, 0, 0, 0.75);
    }
    thead th {
      position: sticky;
      top: 0;
      background-color: #000;
      z-index: 10;
    }
    th, td {
      border: 1px solid #0ff;
      padding: 10px;
      text-align: center;
      color: #fff;
    }
    tbody tr {
      transition: all 0.4s ease-in-out;
    }
    tbody tr:hover {
      background-color: rgba(0, 255, 255, 0.15);
    }
    .gold td { background-color: gold; color: #000; }
    .silver td { background-color: silver; color: #000; }
    .bronze td { background-color: #cd7f32; color: #000; }
    .normal td { background-color: rgba(255,255,255,0.05); }
    .flag { width: 24px; vertical-align: middle; margin-left: 6px; border: 1px solid white; }
    .controls {
      position: fixed;
      bottom: 0;
      width: 100%;
      background-color: rgba(0,0,0,0.9);
      padding: 10px;
      display: flex;
      justify-content: center;
      gap: 10px;
      z-index: 999;
    }
    .controls button, .controls select {
      background: transparent;
      color: #0ff;
      border: 2px solid #0ff;
      padding: 10px 20px;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .controls button:hover, .controls select:hover {
      background: #0ff;
      color: #000;
    }
  </style>
</head>
<body>
  <h1>YCS World Cup</h1>
  <h2>CPU Competition Leaderboard</h2>

  <div class="table-container">
    <table>
      <thead>
        <tr><th>Rank</th><th>Nation</th><th>Name</th><th>ID</th><th>Time</th></tr>
      </thead>
      <tbody id="ranking-body"></tbody>
    </table>
  </div>

  <div class="controls">
    <select id="lang-select" onchange="switchLang()">
      <option value="zh">中文</option>
      <option value="en">English</option>
    </select>
    <button onclick="addRow()">添加选手</button>
    <button onclick="clearTable()">清空</button>
    <button onclick="sortTable()">排序</button>
    <button onclick="downloadCSV()">导出 CSV</button>
    <button onclick="backupData()">备份数据</button>
    <input type="file" id="fileInput" style="display:none" onchange="importData(event)">
    <button onclick="document.getElementById('fileInput').click()">导入备份</button>
    <button onclick="exportPDF()">导出 PDF</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <script>
    const countries = [["CHN","中国"],["IND","印度"],["THA","泰国"],["MYS","马来西亚"],["BGD","孟加拉国"],["PAK","巴基斯坦"],["IDN","印度尼西亚"],["ARE","阿联酋"],["RUS","俄罗斯"],["LAO","老挝"],["TZA","坦桑尼亚"],["DZA","阿尔及利亚"],["GIN","几内亚"],["CUB","古巴"],["BRA","巴西"],["SDN","苏丹"],["KAZ","哈萨克斯坦"],["UZB","乌兹别克斯坦"],["GRC","希腊"],["VNM","越南"]];
    let data = JSON.parse(localStorage.getItem('leaderboard') || '[]');

    function toSeconds(t) {
      const [m, s] = (t || "0:00").split(":").map(Number);
      return m * 60 + s;
    }

    function validateTime(cell, i) {
      setTimeout(() => {
        const val = cell.textContent.trim();
        if (!/^\d{1,2}:\d{2}$/.test(val)) {
          alert("时间格式不正确，应为 分:秒");
          cell.textContent = '';
        } else {
          data[i].time = val;
          save();
        }
      }, 0);
    }

    function save() {
      localStorage.setItem('leaderboard', JSON.stringify(data));
    }

    function render() {
      const body = document.getElementById("ranking-body");
      body.innerHTML = "";
      data.forEach((p, i) => {
        const row = document.createElement("tr");
        row.className = i==0 ? "gold" : i==1 ? "silver" : i==2 ? "bronze" : "normal";
        row.innerHTML = `
          <td>${i + 1}</td>
          <td>
            <select onchange="data[${i}].nation=this.value; save(); render()">
              <option value="">--</option>
              ${countries.map(([code, name]) => 
                `<option value="${code}" ${p.nation===code?"selected":""}>${name} (${code})</option>`).join("")}
            </select>
            <img src="flags/${p.nation || 'CHN'}.png" class="flag">
          </td>
          <td contenteditable oninput="data[${i}].name=this.textContent; save()">${p.name||''}</td>
          <td contenteditable oninput="data[${i}].id=this.textContent; save()">${p.id||''}</td>
          <td contenteditable onblur="validateTime(this, ${i})">${p.time||''}</td>
        `;
        body.appendChild(row);
      });
    }

    function addRow() {
      data.push({ nation: "", name: "", id: "", time: "" });
      render();
      save();
    }

    function clearTable() {
      if (confirm("确定清空全部选手？")) {
        data = [];
        render();
        save();
      }
    }

    function sortTable() {
      data.sort((a,b)=>toSeconds(a.time)-toSeconds(b.time));
      render();
      save();
    }

    function downloadCSV() {
      const rows = [["Rank","Nation","Name","ID","Time"], ...data.map((p,i)=>[i+1,p.nation,p.name,p.id,p.time])];
      const csv = rows.map(r => r.join(",")).join("\n");
      const blob = new Blob([csv], {type: 'text/csv'});
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "leaderboard.csv";
      link.click();
    }

    function backupData() {
      const blob = new Blob([JSON.stringify(data)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "backup.json";
      a.click();
    }

    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        try {
          const parsed = JSON.parse(e.target.result);
          if (!Array.isArray(parsed)) throw "格式错误";
          data = parsed;
          save();
          render();
        } catch (err) {
          alert("导入失败，文件格式无效！");
        }
      };
      reader.readAsText(file);
    }

    function exportPDF() {
      const element = document.getElementById("pdfArea") || document.body;
      const opt = {
        margin:       0.2,
        filename:     'YCS_Leaderboard.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(element).save();
    }

    function switchLang() {
      // 可扩展语言切换
    }

    render();
  </script>
</body>
</html>
